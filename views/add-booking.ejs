<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#667eea">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="icon" type="image/png" href="https://cdn.shopify.com/s/files/1/0940/5274/5549/files/Untitled_design-100_550ad869-e845-4877-9844-37e6bd98b2a0.png?v=1766876822">
  <title>Add Booking - <%= owner.clinicName || 'Dashboard' %></title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
  <link rel="stylesheet" href="/css/styles.css">
  
  <style>
    body { min-height: 100vh; background: var(--bg-primary); }
    .page-wrapper { max-width: 700px; margin: 0 auto; padding: 40px 20px; }
    .page-header { margin-bottom: 32px; animation: slideUp 0.5s ease; }
    @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .back-link { display: inline-flex; align-items: center; gap: 8px; color: var(--text-muted); text-decoration: none; font-size: 14px; font-weight: 500; margin-bottom: 16px; transition: all 0.2s ease; }
    .back-link:hover { color: var(--brand-primary); transform: translateX(-4px); }
    .page-title { font-size: 32px; font-weight: 800; color: var(--text-primary); letter-spacing: -0.5px; }
    .page-subtitle { color: var(--text-muted); margin-top: 8px; }
    .booking-card { background: var(--bg-secondary); border-radius: 20px; padding: 40px; box-shadow: 0 10px 40px -10px rgba(0,0,0,0.08); border: 1px solid var(--border-color); animation: slideUp 0.6s ease 0.1s both; }
    .type-selector { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 32px; }
    .type-option { position: relative; }
    .type-option input { position: absolute; opacity: 0; pointer-events: none; }
    .type-option label { display: flex; flex-direction: column; align-items: center; padding: 24px 20px; background: var(--bg-primary); border: 2px solid var(--border-color); border-radius: 16px; cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
    .type-option label:hover { border-color: var(--brand-primary); transform: translateY(-2px); }
    .type-option input:checked + label { background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%); border-color: var(--brand-primary); box-shadow: 0 8px 25px -8px rgba(102, 126, 234, 0.3); }
    .type-option input:checked + label .type-icon { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
    .type-icon { width: 56px; height: 56px; background: var(--bg-secondary); border-radius: 14px; display: flex; align-items: center; justify-content: center; margin-bottom: 12px; color: var(--text-muted); transition: all 0.3s ease; }
    .type-label { font-weight: 600; color: var(--text-primary); font-size: 15px; }
    .section-divider { display: flex; align-items: center; gap: 16px; margin: 32px 0 24px; }
    .section-divider::before, .section-divider::after { content: ''; flex: 1; height: 1px; background: var(--border-color); }
    .section-title { font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 1.5px; color: var(--text-muted); }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    .form-group { margin-bottom: 24px; }
    .form-label { display: block; font-size: 14px; font-weight: 600; color: var(--text-primary); margin-bottom: 8px; }
    .form-input, .form-select, .form-textarea { width: 100%; padding: 14px 16px; background: var(--bg-primary); border: 2px solid var(--border-color); border-radius: 12px; font-size: 15px; font-family: inherit; color: var(--text-primary); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
    .form-input:focus, .form-select:focus, .form-textarea:focus { outline: none; border-color: var(--brand-primary); background: var(--bg-secondary); box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1); }
    .form-textarea { min-height: 100px; resize: vertical; }
    .form-select { cursor: pointer; appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%238898aa' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 12px center; background-size: 20px; padding-right: 44px; }
    .client-fields { transition: all 0.3s ease; }
    .client-fields.hidden { display: none; }
    .btn-submit { width: 100%; padding: 16px 24px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 12px; font-size: 16px; font-weight: 600; font-family: inherit; color: white; cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 4px 15px -3px rgba(102, 126, 234, 0.4); display: flex; align-items: center; justify-content: center; gap: 10px; margin-top: 8px; }
    .btn-submit:hover { transform: translateY(-2px); box-shadow: 0 8px 25px -5px rgba(102, 126, 234, 0.5); }
    .error-msg { background: linear-gradient(135deg, #fff5f5, #fed7d7); border: 1px solid #feb2b2; color: #c53030; padding: 14px 18px; border-radius: 12px; margin-bottom: 24px; font-size: 14px; }
    @media (max-width: 600px) { .page-wrapper { padding: 24px 16px; } .booking-card { padding: 24px; } .form-row, .type-selector { grid-template-columns: 1fr; } .page-title { font-size: 26px; } }
  </style>
</head>
<body>
  <div class="page-wrapper">
    <div class="page-header">
      <a href="/dashboard" class="back-link">
        <i data-feather="arrow-left" style="width: 18px; height: 18px;"></i>
        Back to Dashboard
      </a>
      <h1 class="page-title">Add New Booking</h1>
      <p class="page-subtitle">Create a new appointment or block a time slot</p>
    </div>
    
    <div class="booking-card">
      <% if (typeof error !== 'undefined' && error) { %>
        <div class="error-msg"><%= error %></div>
      <% } %>
      
      <form method="POST" action="/dashboard/add-booking" id="booking-form">
        <div class="type-selector">
          <div class="type-option">
            <input type="radio" name="type" id="type-booking" value="booking" checked>
            <label for="type-booking">
              <div class="type-icon"><i data-feather="user" style="width: 24px; height: 24px;"></i></div>
              <span class="type-label">Client Booking</span>
            </label>
          </div>
          <div class="type-option">
            <input type="radio" name="type" id="type-blocked" value="blocked">
            <label for="type-blocked">
              <div class="type-icon"><i data-feather="slash" style="width: 24px; height: 24px;"></i></div>
              <span class="type-label">Block Slot</span>
            </label>
          </div>
        </div>
        
        <div class="section-divider"><span class="section-title">Date & Time</span></div>
        
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Date</label>
            <input type="date" name="date" class="form-input" required value="<%= new Date().toISOString().split('T')[0] %>">
          </div>
          <div class="form-group">
            <label class="form-label">Time</label>
            <input type="time" name="time" class="form-input" required value="09:00">
          </div>
        </div>
        
        <div class="client-fields" id="client-fields">
          <div class="section-divider"><span class="section-title">Client Information</span></div>
          
          <div class="form-group">
            <label class="form-label">Client Name</label>
            <input type="text" name="name" class="form-input" placeholder="John Doe">
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Email</label>
              <input type="email" name="email" class="form-input" placeholder="john@example.com">
            </div>
            <div class="form-group">
              <label class="form-label">Phone</label>
              <input type="tel" name="phone" class="form-input" placeholder="+1 234 567 890">
            </div>
          </div>
          
          <div class="form-group">
            <label class="form-label">Service</label>
            <select name="service" class="form-select">
              <% if (owner.settings && owner.settings.services) { owner.settings.services.forEach(service => { %>
                <option value="<%= service %>"><%= service %></option>
              <% }); } %>
            </select>
          </div>
          
          <% if (owner.teamMembers && owner.teamMembers.length > 0) { %>
          <div class="form-group">
            <label class="form-label">Team Member</label>
            <select name="teamMemberId" class="form-select">
              <option value="">-- Any Available --</option>
              <% owner.teamMembers.filter(m => m.isActive !== false).forEach(member => { %>
                <option value="<%= member._id %>"><%= member.name %> - <%= member.role || 'Specialist' %></option>
              <% }) %>
            </select>
          </div>
          <% } %>
        </div>
        
        <div class="form-group">
          <label class="form-label">Notes (Optional)</label>
          <textarea name="notes" class="form-textarea" placeholder="Any additional notes..."></textarea>
        </div>
        
        <button type="submit" class="btn-submit">
          <i data-feather="plus" style="width: 20px; height: 20px;"></i>
          Add Booking
        </button>
      </form>
    </div>
  </div>
  
  <script>
    feather.replace();
    
    const typeBooking = document.getElementById('type-booking');
    const typeBlocked = document.getElementById('type-blocked');
    const clientFields = document.getElementById('client-fields');
    
    function toggleClientFields() {
      clientFields.classList.toggle('hidden', typeBlocked.checked);
    }
    
    typeBooking.addEventListener('change', toggleClientFields);
    typeBlocked.addEventListener('change', toggleClientFields);
  </script>
</body>
</html>
