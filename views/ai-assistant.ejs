<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#8b5cf6">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="manifest" href="/manifest.json">
  <link rel="icon" type="image/png" href="https://cdn.shopify.com/s/files/1/0940/5274/5549/files/Untitled_design-100_550ad869-e845-4877-9844-37e6bd98b2a0.png?v=1766876822">
  <title>AI Assistant - <%= owner.clinicName || 'Dashboard' %></title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    :root {
      --neo-bg: #e0e5ec;
      --neo-shadow-dark: #a3b1c6;
      --neo-shadow-light: #ffffff;
      --neo-primary: #10b981;
      --neo-text: #1e293b;
      --neo-text-muted: #64748b;
      --neo-card-bg: #e0e5ec;
    }
    
    [data-theme="dark"] {
      --neo-bg: #1c1c1e;
      --neo-shadow-dark: #0a0a0b;
      --neo-shadow-light: #2c2c2e;
      --neo-text: #ffffff;
      --neo-text-muted: #a1a1a6;
      --neo-card-bg: #2c2c2e;
    }
    
    [data-theme="dark"] .chat-messages {
      background: var(--neo-card-bg);
    }
    
    [data-theme="dark"] .message-content {
      background: #3a3a3c;
    }
    
    [data-theme="dark"] .nav-link {
      color: #ffffff;
    }
    
    [data-theme="dark"] input,
    [data-theme="dark"] textarea {
      background: #3a3a3c !important;
      color: #ffffff !important;
    }
    
    .theme-toggle {
      background: var(--neo-bg);
      border: none;
      padding: 10px;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 3px 3px 6px var(--neo-shadow-dark), -3px -3px 6px var(--neo-shadow-light);
    }
    .theme-toggle svg { width: 20px; height: 20px; stroke: var(--neo-text); }
    [data-theme="dark"] .sun-icon { display: block; }
    [data-theme="dark"] .moon-icon { display: none; }
    .sun-icon { display: none; }
    .moon-icon { display: block; }
    
    body {
      min-height: 100vh;
      background: var(--neo-bg);
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      display: flex;
      flex-direction: column;
    }
    
    .navbar {
      background: var(--neo-bg);
      padding: 16px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 4px 12px var(--neo-shadow-dark);
      flex-wrap: wrap;
      gap: 12px;
    }
    
    .navbar-brand {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .navbar-logo {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, #8b5cf6, #7c3aed);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .navbar-logo svg {
      width: 22px;
      height: 22px;
      stroke: white;
      fill: none;
    }
    
    .navbar-title {
      color: var(--neo-text);
      font-size: 18px;
      font-weight: 700;
    }
    
    .navbar-actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    
    .nav-link {
      color: var(--neo-text-muted);
      text-decoration: none;
      padding: 8px 16px;
      border-radius: 10px;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.3s ease;
      background: var(--neo-bg);
      box-shadow: 3px 3px 6px var(--neo-shadow-dark), -3px -3px 6px var(--neo-shadow-light);
    }
    
    .nav-link:hover {
      color: var(--neo-text);
    }
    
    .nav-link.active {
      background: linear-gradient(135deg, #8b5cf6, #7c3aed);
      color: white;
    }
    
    .chat-container {
      flex: 1;
      max-width: 900px;
      width: 100%;
      margin: 0 auto;
      padding: 24px 16px;
      display: flex;
      flex-direction: column;
    }
    
    .chat-header {
      text-align: center;
      margin-bottom: 24px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
    }
    
    .chat-header-icon {
      width: 56px;
      height: 56px;
      background: linear-gradient(135deg, #8b5cf6, #7c3aed);
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .chat-header-icon svg {
      width: 28px;
      height: 28px;
      stroke: white;
      fill: none;
    }
    
    .chat-header h1 {
      color: var(--neo-text);
      font-size: 24px;
      font-weight: 700;
    }
    
    .chat-header p {
      color: var(--neo-text-muted);
      font-size: 14px;
    }
    
    .quick-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 24px;
    }
    
    .quick-btn {
      padding: 10px 16px;
      border: none;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      background: var(--neo-bg);
      color: var(--neo-text-muted);
      box-shadow: 3px 3px 6px var(--neo-shadow-dark), -3px -3px 6px var(--neo-shadow-light);
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .quick-btn:hover {
      color: var(--neo-text);
      transform: translateY(-2px);
    }
    
    .quick-btn svg {
      width: 14px;
      height: 14px;
      stroke: currentColor;
      fill: none;
    }
    
    .chat-messages {
      flex: 1;
      background: var(--neo-bg);
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: inset 4px 4px 8px var(--neo-shadow-dark), inset -4px -4px 8px var(--neo-shadow-light);
      overflow-y: auto;
      min-height: 300px;
      max-height: 500px;
    }
    
    .message {
      margin-bottom: 16px;
      display: flex;
      gap: 12px;
    }
    
    .message.user {
      flex-direction: row-reverse;
    }
    
    .message-avatar {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    
    .message.assistant .message-avatar {
      background: linear-gradient(135deg, #8b5cf6, #7c3aed);
    }
    
    .message.assistant .message-avatar svg {
      width: 18px;
      height: 18px;
      stroke: white;
      fill: none;
    }
    
    .message.user .message-avatar {
      background: linear-gradient(135deg, #10b981, #059669);
    }
    
    .message.user .message-avatar svg {
      width: 18px;
      height: 18px;
      stroke: white;
      fill: none;
    }
    
    .message-content {
      max-width: 70%;
      padding: 14px 18px;
      border-radius: 16px;
      font-size: 14px;
      line-height: 1.6;
    }
    
    .message.assistant .message-content {
      background: white;
      color: var(--neo-text);
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    
    .message.user .message-content {
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
    }
    
    .chat-input-container {
      display: flex;
      gap: 12px;
    }
    
    .chat-input {
      flex: 1;
      padding: 16px 20px;
      background: var(--neo-bg);
      border: none;
      border-radius: 16px;
      font-size: 15px;
      color: var(--neo-text);
      box-shadow: inset 4px 4px 8px var(--neo-shadow-dark), inset -4px -4px 8px var(--neo-shadow-light);
    }
    
    .chat-input:focus {
      outline: none;
    }
    
    .chat-input::placeholder {
      color: var(--neo-text-muted);
    }
    
    .send-btn {
      padding: 16px 24px;
      border: none;
      border-radius: 16px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(135deg, #8b5cf6, #7c3aed);
      color: white;
      box-shadow: 4px 4px 8px var(--neo-shadow-dark), -4px -4px 8px var(--neo-shadow-light);
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .send-btn:hover {
      transform: translateY(-2px);
    }
    
    .send-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    
    .send-btn svg {
      width: 18px;
      height: 18px;
      stroke: currentColor;
      fill: none;
    }
    
    .stats-summary {
      background: white;
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    
    .stats-summary h3 {
      font-size: 14px;
      font-weight: 700;
      color: var(--neo-text);
      margin-bottom: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
    }
    
    .stat-item {
      text-align: center;
      padding: 12px;
      background: #f8fafc;
      border-radius: 10px;
    }
    
    .stat-value {
      font-size: 24px;
      font-weight: 700;
      color: var(--neo-primary);
    }
    
    .stat-label {
      font-size: 11px;
      color: var(--neo-text-muted);
      text-transform: uppercase;
      margin-top: 4px;
    }
    
    .typing-indicator {
      display: flex;
      gap: 4px;
      padding: 8px 0;
    }
    
    .typing-indicator span {
      width: 8px;
      height: 8px;
      background: var(--neo-text-muted);
      border-radius: 50%;
      animation: typing 1.4s infinite ease-in-out;
    }
    
    .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
    .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
    
    @keyframes typing {
      0%, 60%, 100% { transform: translateY(0); }
      30% { transform: translateY(-8px); }
    }
    
    @media (max-width: 768px) {
      .stats-grid { grid-template-columns: repeat(2, 1fr); }
      .message-content { max-width: 85%; }
      .quick-actions { gap: 8px; }
      .quick-btn { padding: 8px 12px; font-size: 12px; }
    }
  </style>
</head>
<body>
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-logo">
        <svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"/>
          <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
          <line x1="12" y1="17" x2="12.01" y2="17"/>
        </svg>
      </div>
      <span class="navbar-title">AI Assistant</span>
    </div>
    <div class="navbar-actions">
      <a href="/dashboard" class="nav-link">Bookings</a>
      <a href="/dashboard/settings" class="nav-link">Settings</a>
      <a href="/dashboard/ai-assistant" class="nav-link active">AI Assistant</a>
      <button type="button" class="theme-toggle" id="theme-toggle" title="Toggle dark mode">
        <svg class="moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
        <svg class="sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
      </button>
      <a href="/logout" class="nav-link">Logout</a>
    </div>
  </nav>
  
  <div class="chat-container">
    <div class="chat-header">
      <div class="chat-header-icon">
        <svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
        </svg>
      </div>
      <h1>AI Business Assistant</h1>
      <p>Ask me anything about your bookings, get insights, or tips to grow your business</p>
    </div>
    
    <div class="stats-summary">
      <h3>Your Business Overview</h3>
      <div class="stats-grid">
        <div class="stat-item">
          <div class="stat-value"><%= stats.totalBookings %></div>
          <div class="stat-label">Total Bookings</div>
        </div>
        <div class="stat-item">
          <div class="stat-value"><%= stats.todayBookings %></div>
          <div class="stat-label">Today</div>
        </div>
        <div class="stat-item">
          <div class="stat-value"><%= stats.weekBookings %></div>
          <div class="stat-label">This Week</div>
        </div>
        <div class="stat-item">
          <div class="stat-value"><%= stats.completionRate %>%</div>
          <div class="stat-label">Completion</div>
        </div>
      </div>
    </div>
    
    <div class="quick-actions">
      <button class="quick-btn" onclick="askQuestion('How do I use this dashboard?')">
        <svg viewBox="0 0 24 24" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
        Tutorial
      </button>
      <button class="quick-btn" onclick="askQuestion('What are my busiest days?')">
        <svg viewBox="0 0 24 24" stroke-width="2"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>
        Busiest Days
      </button>
      <button class="quick-btn" onclick="askQuestion('How can I reduce no-shows?')">
        <svg viewBox="0 0 24 24" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
        Reduce No-Shows
      </button>
      <button class="quick-btn" onclick="askQuestion('Tips to get more bookings')">
        <svg viewBox="0 0 24 24" stroke-width="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>
        Get More Bookings
      </button>
      <button class="quick-btn" onclick="askQuestion('Summarize my week')">
        <svg viewBox="0 0 24 24" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
        Weekly Summary
      </button>
    </div>
    
    <div class="chat-messages" id="chatMessages">
      <div class="message assistant">
        <div class="message-avatar">
          <svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
          </svg>
        </div>
        <div class="message-content">
          Hello! I'm your AI business assistant. I can help you with:
          <br><br>
          <strong>Dashboard Tutorial</strong> - Learn how to use all features
          <br><strong>Booking insights</strong> - Understand your busiest times
          <br><strong>Business tips</strong> - Reduce no-shows, increase bookings
          <br><strong>Quick reports</strong> - Summaries and statistics
          <br><br>
          Click <strong>Tutorial</strong> above to learn how to use the dashboard!
        </div>
      </div>
    </div>
    
    <div class="chat-input-container">
      <input type="text" class="chat-input" id="chatInput" placeholder="Ask me anything about your business...">
      <button class="send-btn" id="sendBtn">
        <svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="22" y1="2" x2="11" y2="13"/>
          <polygon points="22 2 15 22 11 13 2 9 22 2"/>
        </svg>
        Send
      </button>
    </div>
  </div>
  
  <script>
    const stats = {
      totalBookings: <%= stats.totalBookings %>,
      todayBookings: <%= stats.todayBookings %>,
      weekBookings: <%= stats.weekBookings %>,
      completionRate: <%= stats.completionRate %>,
      noShowRate: <%= stats.noShowRate %>,
      popularService: '<%= stats.popularService %>',
      busiestDay: '<%= stats.busiestDay %>'
    };
    
    const businessName = '<%= owner.clinicName || "your business" %>';
    
    // SVG icons for messages
    const aiIcon = '<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>';
    const userIcon = '<svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>';
    
    function askQuestion(question) {
      document.getElementById('chatInput').value = question;
      sendMessage();
    }
    
    function addMessage(content, isUser) {
      const messagesDiv = document.getElementById('chatMessages');
      const messageDiv = document.createElement('div');
      messageDiv.className = 'message ' + (isUser ? 'user' : 'assistant');
      messageDiv.innerHTML = '<div class="message-avatar">' + (isUser ? userIcon : aiIcon) + '</div><div class="message-content">' + content + '</div>';
      messagesDiv.appendChild(messageDiv);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }
    
    function showTyping() {
      const messagesDiv = document.getElementById('chatMessages');
      const typingDiv = document.createElement('div');
      typingDiv.className = 'message assistant';
      typingDiv.id = 'typingIndicator';
      typingDiv.innerHTML = '<div class="message-avatar">' + aiIcon + '</div><div class="message-content"><div class="typing-indicator"><span></span><span></span><span></span></div></div>';
      messagesDiv.appendChild(typingDiv);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }
    
    function removeTyping() {
      const typing = document.getElementById('typingIndicator');
      if (typing) typing.remove();
    }
    
    function generateResponse(question) {
      const q = question.toLowerCase();
      
      // TUTORIAL - Complete dashboard guide
      if (q.includes('tutorial') || q.includes('how do i use') || q.includes('help') || q.includes('guide')) {
        return '<strong>COMPLETE DASHBOARD TUTORIAL</strong><br><br>' +
          '<strong>1. BOOKINGS PAGE</strong><br>' +
          'This is your main page where you see all appointments.<br><br>' +
          '<strong>View Options:</strong><br>' +
          '- <strong>Today</strong> - See only today\'s appointments<br>' +
          '- <strong>This Week</strong> - See this week\'s appointments<br>' +
          '- <strong>This Month</strong> - See this month\'s appointments<br>' +
          '- <strong>All</strong> - See all appointments<br>' +
          '- <strong>Date Picker</strong> - Choose a specific date<br><br>' +
          '<strong>Booking Actions:</strong><br>' +
          '- <strong>Edit</strong> - Change booking details<br>' +
          '- <strong>Done</strong> - Mark appointment as completed<br>' +
          '- <strong>No-Show</strong> - Client didn\'t show up<br>' +
          '- <strong>Cancel</strong> - Cancel the booking (sends email to client)<br>' +
          '- <strong>Mail Icon</strong> - Send reminder email to client<br><br>' +
          '<strong>Add Booking:</strong><br>' +
          'Click the green "+ Add Booking" button to manually add a new appointment.<br><br>' +
          'Type <strong>"settings tutorial"</strong> to learn about Settings, or <strong>"email tutorial"</strong> to learn about emails!';
      }
      
      // Settings tutorial
      if (q.includes('settings')) {
        return '<strong>SETTINGS TUTORIAL</strong><br><br>' +
          '<strong>BUSINESS TAB:</strong><br>' +
          '- <strong>Business Name</strong> - Your company name (shown in emails)<br>' +
          '- <strong>Phone</strong> - Contact number for clients<br>' +
          '- <strong>Website URL</strong> - Your website link<br>' +
          '- <strong>Address</strong> - Your location (shown in emails)<br>' +
          '- <strong>Services</strong> - List of services you offer (comma separated)<br><br>' +
          '<strong>SCHEDULE TAB:</strong><br>' +
          '- <strong>Opening/Closing Hour</strong> - Your working hours<br>' +
          '- <strong>Slots Per Hour</strong> - How many bookings per hour<br>' +
          '- <strong>Working Days</strong> - Which days you accept bookings<br><br>' +
          '<strong>EMAIL TEMPLATES TAB:</strong><br>' +
          '- <strong>Logo URL</strong> - Your logo for emails<br>' +
          '- <strong>Colors</strong> - Customize email colors<br>' +
          '- <strong>Confirmation/Cancellation/Reminder</strong> - Customize each email type<br><br>' +
          'Remember to click <strong>Save All Settings</strong> after making changes!';
      }
      
      // Email tutorial
      if (q.includes('email')) {
        return '<strong>EMAIL SYSTEM TUTORIAL</strong><br><br>' +
          '<strong>AUTOMATIC EMAILS:</strong><br>' +
          '- <strong>Confirmation Email</strong> - Sent when client books<br>' +
          '- <strong>Cancellation Email</strong> - Sent when you cancel a booking<br>' +
          '- <strong>Reminder Email</strong> - Sent automatically 1 day before appointment<br><br>' +
          '<strong>MANUAL REMINDER:</strong><br>' +
          'Click the mail icon on any booking to send a reminder email immediately.<br><br>' +
          '<strong>CUSTOMIZE EMAILS:</strong><br>' +
          'Go to Settings > Email Templates to:<br>' +
          '- Add your logo<br>' +
          '- Change colors to match your brand<br>' +
          '- Edit subject lines and messages<br>' +
          '- Add a custom footer<br><br>' +
          '<strong>IMPORTANT:</strong> Make sure your Address is set in Settings so it appears correctly in emails!';
      }
      
      // Busiest days analysis
      if (q.includes('busiest') || q.includes('busy')) {
        return 'Based on your booking data, <strong>' + stats.busiestDay + '</strong> tends to be your busiest day.<br><br>' +
          '<strong>Tip:</strong> Consider offering special promotions on slower days to balance your schedule and maximize revenue.';
      }
      
      // No-shows
      if (q.includes('no-show') || q.includes('noshow') || q.includes('cancel')) {
        const tips = stats.noShowRate > 15 
          ? 'Your no-show rate is ' + stats.noShowRate + '%, which is above average.'
          : 'Your no-show rate is ' + stats.noShowRate + '%, which is good!';
        return tips + '<br><br>Here are proven strategies to reduce no-shows:<br><br>' +
          '<strong>Send reminders</strong> - Use the mail icon to send reminders<br>' +
          '<strong>Automatic reminders</strong> - System sends emails 1 day before<br>' +
          '<strong>Require deposits</strong> - Even small ones reduce no-shows by 50%<br>' +
          '<strong>Easy rescheduling</strong> - Make it simple to change appointments';
      }
      
      // More bookings
      if (q.includes('more booking') || q.includes('increase') || q.includes('grow')) {
        return 'Here are strategies to grow ' + businessName + ':<br><br>' +
          '<strong>Google Business Profile</strong> - Claim and optimize it<br>' +
          '<strong>Social media</strong> - Share testimonials and results<br>' +
          '<strong>Referral program</strong> - Reward clients who refer friends<br>' +
          '<strong>Email marketing</strong> - Stay in touch with past clients<br>' +
          '<strong>Online reviews</strong> - Ask happy clients to leave reviews<br><br>' +
          'Your most popular service is <strong>' + stats.popularService + '</strong> - consider promoting it more!';
      }
      
      // Weekly summary
      if (q.includes('summary') || q.includes('week') || q.includes('report')) {
        return '<strong>Weekly Summary for ' + businessName + '</strong><br><br>' +
          'Total bookings this week: <strong>' + stats.weekBookings + '</strong><br>' +
          'Today\'s appointments: <strong>' + stats.todayBookings + '</strong><br>' +
          'Completion rate: <strong>' + stats.completionRate + '%</strong><br>' +
          'Most popular service: <strong>' + stats.popularService + '</strong><br><br>' +
          (stats.completionRate >= 85 ? 'Great job! Your completion rate is excellent.' : 'Consider implementing reminder emails to improve completion rate.');
      }
      
      // Services
      if (q.includes('service') || q.includes('popular')) {
        return 'Your most popular service is <strong>' + stats.popularService + '</strong>.<br><br>' +
          '<strong>Tips:</strong><br>' +
          'Create packages combining popular services<br>' +
          'Offer loyalty discounts for repeat bookings<br>' +
          'Consider adding complementary services';
      }
      
      // Stats/numbers
      if (q.includes('stat') || q.includes('number') || q.includes('data')) {
        return '<strong>Your Business Stats:</strong><br><br>' +
          'Total bookings: <strong>' + stats.totalBookings + '</strong><br>' +
          'Today: <strong>' + stats.todayBookings + '</strong><br>' +
          'This week: <strong>' + stats.weekBookings + '</strong><br>' +
          'Completion rate: <strong>' + stats.completionRate + '%</strong><br>' +
          'No-show rate: <strong>' + stats.noShowRate + '%</strong><br>' +
          'Busiest day: <strong>' + stats.busiestDay + '</strong><br>' +
          'Top service: <strong>' + stats.popularService + '</strong>';
      }
      
      // Team members
      if (q.includes('team') || q.includes('member') || q.includes('specialist') || q.includes('doctor')) {
        const teamMembers = <%- JSON.stringify(owner.teamMembers || []) %>;
        if (teamMembers.length === 0) {
          return '<strong>Team Members</strong><br><br>' +
            'You haven\'t added any team members yet.<br><br>' +
            '<strong>To add team members:</strong><br>' +
            '1. Go to <strong>Settings</strong><br>' +
            '2. Click on the <strong>Team</strong> tab<br>' +
            '3. Fill in the team member details<br>' +
            '4. Click <strong>+ Add Team Member</strong><br><br>' +
            'Team members can be assigned to specific bookings!';
        }
        let teamHtml = '<strong>Your Team (' + teamMembers.length + ' members)</strong><br><br>';
        teamMembers.forEach(m => {
          teamHtml += '<div style="margin-bottom: 8px;">â€¢ <strong>' + m.name + '</strong> - ' + (m.role || 'Specialist') + '</div>';
        });
        teamHtml += '<br>To see bookings per team member, check the dashboard - each booking shows the assigned team member.';
        return teamHtml;
      }
      
      // Export clients
      if (q.includes('export') || q.includes('download') || q.includes('excel') || q.includes('csv') || q.includes('client list')) {
        return '<strong>Export Clients</strong><br><br>' +
          'You can export your client list to CSV (Excel compatible).<br><br>' +
          '<a href="/api/export-clients?format=csv" style="display: inline-block; padding: 10px 20px; background: linear-gradient(135deg, #10b981, #059669); color: white; border-radius: 10px; text-decoration: none; font-weight: 600;">ðŸ“¥ Download Client List (CSV)</a><br><br>' +
          'The file includes: Name, Email, Phone, Total Bookings, Last Visit';
      }
      
      // Client search
      if (q.includes('find client') || q.includes('search client') || q.includes('client named') || q.includes('when was')) {
        return '<strong>Client Search</strong><br><br>' +
          'To find a specific client:<br>' +
          '1. Go to the <strong>Bookings</strong> page<br>' +
          '2. Click on any <strong>client name</strong> (underlined)<br>' +
          '3. A popup will show their complete history<br><br>' +
          'The history includes: Total visits, Completed, Cancelled, and all past bookings.';
      }
      
      // Day off / blocking
      if (q.includes('day off') || q.includes('block') || q.includes('vacation') || q.includes('holiday')) {
        return '<strong>Blocking Time / Day Off</strong><br><br>' +
          'To block time slots:<br>' +
          '1. Go to <strong>Bookings</strong> page<br>' +
          '2. Click the orange <strong>Day Off</strong> button<br>' +
          '3. Select the date and optionally a team member<br>' +
          '4. Add a reason (optional)<br>' +
          '5. Click <strong>Block Day</strong><br><br>' +
          'This will block all slots for that day. Clients won\'t be able to book during blocked times.';
      }
      
      // WhatsApp
      if (q.includes('whatsapp') || q.includes('message') || q.includes('sms')) {
        return '<strong>WhatsApp & Messaging</strong><br><br>' +
          'Each booking with a phone number has a <strong>green WhatsApp button</strong>.<br><br>' +
          'To customize the message:<br>' +
          '1. Go to <strong>Settings</strong><br>' +
          '2. Click <strong>Email Templates</strong> tab<br>' +
          '3. Scroll to the green <strong>WhatsApp Message Template</strong> section<br>' +
          '4. Customize your message using variables:<br>' +
          '   - {clientName} - Client\'s name<br>' +
          '   - {date} - Appointment date<br>' +
          '   - {time} - Appointment time<br>' +
          '   - {clinicName} - Your business name';
      }
      
      // Default response
      return 'I can help you with:<br><br>' +
        '<strong>"Tutorial"</strong> - Learn how to use the dashboard<br>' +
        '<strong>"Settings tutorial"</strong> - Learn about settings<br>' +
        '<strong>"Team members"</strong> - Manage your team<br>' +
        '<strong>"Export clients"</strong> - Download client list<br>' +
        '<strong>"Day off"</strong> - Block time slots<br>' +
        '<strong>"WhatsApp"</strong> - Messaging setup<br>' +
        '<strong>"What are my busiest days?"</strong> - Booking patterns<br>' +
        '<strong>"How can I reduce no-shows?"</strong> - Practical tips<br>' +
        '<strong>"Summarize my week"</strong> - Quick overview<br><br>' +
        'Try asking one of these questions!';
    }
    
    function sendMessage() {
      const input = document.getElementById('chatInput');
      const question = input.value.trim();
      
      if (!question) return;
      
      addMessage(question, true);
      input.value = '';
      
      showTyping();
      document.getElementById('sendBtn').disabled = true;
      
      // Simulate AI thinking
      setTimeout(function() {
        removeTyping();
        const response = generateResponse(question);
        addMessage(response, false);
        document.getElementById('sendBtn').disabled = false;
      }, 800 + Math.random() * 700);
    }
    
    // Event listeners
    document.getElementById('chatInput').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        sendMessage();
      }
    });
    
    document.getElementById('sendBtn').addEventListener('click', function() {
      sendMessage();
    });
    
    // Dark Mode Toggle
    const themeToggle = document.getElementById('theme-toggle');
    const savedTheme = localStorage.getItem('theme') || 'light';
    document.documentElement.setAttribute('data-theme', savedTheme);
    
    themeToggle.addEventListener('click', () => {
      const currentTheme = document.documentElement.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
    });
  </script>
</body>
</html>
