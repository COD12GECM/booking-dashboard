<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#667eea">
  <link rel="icon" type="image/png" href="https://cdn.shopify.com/s/files/1/0940/5274/5549/files/Untitled_design-100_550ad869-e845-4877-9844-37e6bd98b2a0.png?v=1766876822">
  <title>Settings - <%= owner.clinicName || 'Dashboard' %></title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
  <link rel="stylesheet" href="/css/styles.css">
  
  <style>
    body { min-height: 100vh; background: var(--bg-primary); }
    .settings-layout { display: flex; min-height: 100vh; }
    
    /* Sidebar */
    .settings-sidebar { width: 280px; background: var(--bg-secondary); border-right: 1px solid var(--border-color); padding: 32px 0; position: fixed; height: 100vh; overflow-y: auto; }
    .sidebar-header { padding: 0 24px 24px; border-bottom: 1px solid var(--border-color); margin-bottom: 24px; }
    .sidebar-back { display: flex; align-items: center; gap: 8px; color: var(--text-muted); text-decoration: none; font-size: 14px; margin-bottom: 16px; transition: color 0.2s; }
    .sidebar-back:hover { color: var(--brand-primary); }
    .sidebar-title { font-size: 24px; font-weight: 800; color: var(--text-primary); }
    .sidebar-nav { padding: 0 12px; }
    .nav-item { display: flex; align-items: center; gap: 12px; padding: 12px 16px; border-radius: 10px; color: var(--text-secondary); text-decoration: none; font-weight: 500; margin-bottom: 4px; transition: all 0.2s; cursor: pointer; border: none; background: none; width: 100%; text-align: left; font-size: 15px; }
    .nav-item:hover { background: var(--bg-tertiary); color: var(--text-primary); }
    .nav-item.active { background: linear-gradient(135deg, rgba(102,126,234,0.1), rgba(118,75,162,0.1)); color: var(--brand-primary); font-weight: 600; }
    .nav-item.active::before { content: ''; position: absolute; left: 0; width: 3px; height: 24px; background: linear-gradient(180deg, #667eea, #764ba2); border-radius: 0 4px 4px 0; }
    .nav-icon { width: 20px; height: 20px; opacity: 0.7; }
    .nav-item:hover .nav-icon, .nav-item.active .nav-icon { opacity: 1; }
    
    /* Main Content */
    .settings-main { flex: 1; margin-left: 280px; padding: 40px; }
    .settings-header { margin-bottom: 32px; }
    .settings-page-title { font-size: 28px; font-weight: 700; color: var(--text-primary); margin-bottom: 8px; }
    .settings-page-desc { color: var(--text-muted); }
    
    .settings-card { background: var(--bg-secondary); border-radius: 16px; border: 1px solid var(--border-color); padding: 32px; margin-bottom: 24px; }
    .card-title { font-size: 18px; font-weight: 700; color: var(--text-primary); margin-bottom: 24px; display: flex; align-items: center; gap: 12px; }
    .card-title-icon { width: 40px; height: 40px; background: linear-gradient(135deg, rgba(102,126,234,0.1), rgba(118,75,162,0.1)); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: var(--brand-primary); }
    
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    .form-row-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; }
    .form-group { margin-bottom: 20px; }
    .form-label { display: block; font-size: 14px; font-weight: 600; color: var(--text-primary); margin-bottom: 8px; }
    .form-hint { font-size: 13px; color: var(--text-muted); margin-top: 6px; }
    .form-input, .form-select, .form-textarea { width: 100%; padding: 12px 16px; background: var(--bg-primary); border: 2px solid var(--border-color); border-radius: 10px; font-size: 15px; font-family: inherit; color: var(--text-primary); transition: all 0.2s; }
    .form-input:focus, .form-select:focus, .form-textarea:focus { outline: none; border-color: var(--brand-primary); box-shadow: 0 0 0 3px rgba(102,126,234,0.1); }
    .form-textarea { min-height: 100px; resize: vertical; }
    
    .btn-save { padding: 14px 32px; background: linear-gradient(135deg, #667eea, #764ba2); border: none; border-radius: 10px; font-size: 15px; font-weight: 600; color: white; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 15px -3px rgba(102,126,234,0.4); }
    .btn-save:hover { transform: translateY(-2px); box-shadow: 0 8px 25px -5px rgba(102,126,234,0.5); }
    
    .success-msg { background: linear-gradient(135deg, #ecfdf5, #d1fae5); border: 1px solid #a7f3d0; color: #065f46; padding: 14px 18px; border-radius: 10px; margin-bottom: 24px; display: flex; align-items: center; gap: 10px; }
    
    /* Days selector */
    .days-grid { display: flex; flex-wrap: wrap; gap: 10px; }
    .day-btn { padding: 10px 16px; border: 2px solid var(--border-color); border-radius: 8px; background: var(--bg-primary); color: var(--text-secondary); font-weight: 500; cursor: pointer; transition: all 0.2s; }
    .day-btn.active { background: linear-gradient(135deg, #667eea, #764ba2); border-color: transparent; color: white; }
    .day-btn:hover:not(.active) { border-color: var(--brand-primary); }
    
    /* Team members */
    .team-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px; }
    .team-card { background: var(--bg-primary); border-radius: 12px; padding: 20px; display: flex; align-items: center; gap: 16px; }
    .team-avatar { width: 48px; height: 48px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 18px; }
    .team-info h4 { font-weight: 600; color: var(--text-primary); margin-bottom: 4px; }
    .team-info p { font-size: 13px; color: var(--text-muted); }
    .team-actions { margin-left: auto; display: flex; gap: 8px; }
    .team-btn { width: 32px; height: 32px; border-radius: 8px; border: 1px solid var(--border-color); background: var(--bg-secondary); display: flex; align-items: center; justify-content: center; cursor: pointer; color: var(--text-muted); transition: all 0.2s; }
    .team-btn:hover { border-color: var(--brand-primary); color: var(--brand-primary); }
    .team-btn.danger:hover { border-color: #ef4444; color: #ef4444; }
    
    /* Color picker */
    .color-row { display: flex; gap: 12px; align-items: center; }
    .color-picker { width: 48px; height: 48px; border: none; border-radius: 10px; cursor: pointer; padding: 0; }
    
    /* Tab content */
    .tab-content { display: none; }
    .tab-content.active { display: block; animation: fadeIn 0.3s ease; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    
    /* Responsive */
    @media (max-width: 900px) {
      .settings-sidebar { display: none; }
      .settings-main { margin-left: 0; padding: 24px 16px; }
      .form-row, .form-row-3 { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="settings-layout">
    <!-- Sidebar -->
    <aside class="settings-sidebar">
      <div class="sidebar-header">
        <a href="/dashboard" class="sidebar-back">
          <i data-feather="arrow-left" style="width:16px;height:16px;"></i> Back to Dashboard
        </a>
        <h1 class="sidebar-title">Settings</h1>
      </div>
      <nav class="sidebar-nav">
        <button type="button" class="nav-item active" data-tab="business">
          <i data-feather="briefcase" class="nav-icon"></i> Business Info
        </button>
        <button type="button" class="nav-item" data-tab="schedule">
          <i data-feather="clock" class="nav-icon"></i> Schedule
        </button>
        <button type="button" class="nav-item" data-tab="team">
          <i data-feather="users" class="nav-icon"></i> Team Members
        </button>
        <button type="button" class="nav-item" data-tab="email">
          <i data-feather="mail" class="nav-icon"></i> Email Templates
        </button>
        <button type="button" class="nav-item" data-tab="integrations">
          <i data-feather="link" class="nav-icon"></i> Integrations
        </button>
      </nav>
    </aside>
    
    <!-- Main Content -->
    <main class="settings-main">
      <% if (typeof success !== 'undefined' && success) { %>
        <div class="success-msg">
          <i data-feather="check-circle" style="width:20px;height:20px;"></i>
          <%= success %>
        </div>
      <% } %>
      
      <form method="POST" action="/dashboard/settings">
        <!-- BUSINESS TAB -->
        <div class="tab-content active" id="tab-business">
          <div class="settings-header">
            <h2 class="settings-page-title">Business Information</h2>
            <p class="settings-page-desc">Manage your business details and services</p>
          </div>
          
          <div class="settings-card">
            <div class="card-title">
              <div class="card-title-icon"><i data-feather="home" style="width:20px;height:20px;"></i></div>
              Basic Information
            </div>
            
            <div class="form-group">
              <label class="form-label">Business Name</label>
              <input type="text" name="clinicName" class="form-input" value="<%= owner.clinicName || '' %>" placeholder="Your business name">
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Phone</label>
                <input type="tel" name="clinicPhone" class="form-input" value="<%= owner.clinicPhone || '' %>" placeholder="+1 234 567 890">
              </div>
              <div class="form-group">
                <label class="form-label">Website</label>
                <input type="url" name="websiteUrl" class="form-input" value="<%= owner.websiteUrl || '' %>" placeholder="https://...">
              </div>
            </div>
            
            <div class="form-group">
              <label class="form-label">Address</label>
              <input type="text" name="clinicAddress" class="form-input" value="<%= owner.clinicAddress || '' %>" placeholder="Your business address">
            </div>
          </div>
          
          <div class="settings-card">
            <div class="card-title">
              <div class="card-title-icon"><i data-feather="list" style="width:20px;height:20px;"></i></div>
              Services
            </div>
            
            <div class="form-group">
              <label class="form-label">Services Offered</label>
              <input type="text" name="services" class="form-input" value="<%= owner.settings && owner.settings.services ? owner.settings.services.join(', ') : '' %>" placeholder="Consultation, Follow-up, Premium">
              <p class="form-hint">Separate services with commas</p>
            </div>
          </div>
          
          <button type="submit" class="btn-save">
            <i data-feather="save" style="width:18px;height:18px;margin-right:8px;"></i> Save Changes
          </button>
        </div>
        
        <!-- SCHEDULE TAB -->
        <div class="tab-content" id="tab-schedule">
          <div class="settings-header">
            <h2 class="settings-page-title">Schedule Settings</h2>
            <p class="settings-page-desc">Configure your working hours and availability</p>
          </div>
          
          <div class="settings-card">
            <div class="card-title">
              <div class="card-title-icon"><i data-feather="clock" style="width:20px;height:20px;"></i></div>
              Working Hours
            </div>
            
            <div class="form-row-3">
              <div class="form-group">
                <label class="form-label">Opening Hour</label>
                <input type="number" name="startHour" class="form-input" value="<%= owner.settings ? owner.settings.startHour : 9 %>" min="0" max="23">
              </div>
              <div class="form-group">
                <label class="form-label">Closing Hour</label>
                <input type="number" name="endHour" class="form-input" value="<%= owner.settings ? owner.settings.endHour : 17 %>" min="0" max="23">
              </div>
              <div class="form-group">
                <label class="form-label">Slots Per Hour</label>
                <input type="number" name="slotsPerHour" class="form-input" value="<%= owner.settings ? owner.settings.slotsPerHour : 2 %>" min="1" max="10">
              </div>
            </div>
          </div>
          
          <div class="settings-card">
            <div class="card-title">
              <div class="card-title-icon"><i data-feather="calendar" style="width:20px;height:20px;"></i></div>
              Working Days
            </div>
            
            <% const workingDays = owner.settings && owner.settings.workingDays ? owner.settings.workingDays : [1,2,3,4,5]; %>
            <input type="hidden" name="workingDaysData" id="workingDaysData" value="<%= JSON.stringify(workingDays) %>">
            
            <div class="days-grid">
              <button type="button" class="day-btn <%= workingDays.includes(1) ? 'active' : '' %>" data-day="1">Mon</button>
              <button type="button" class="day-btn <%= workingDays.includes(2) ? 'active' : '' %>" data-day="2">Tue</button>
              <button type="button" class="day-btn <%= workingDays.includes(3) ? 'active' : '' %>" data-day="3">Wed</button>
              <button type="button" class="day-btn <%= workingDays.includes(4) ? 'active' : '' %>" data-day="4">Thu</button>
              <button type="button" class="day-btn <%= workingDays.includes(5) ? 'active' : '' %>" data-day="5">Fri</button>
              <button type="button" class="day-btn <%= workingDays.includes(6) ? 'active' : '' %>" data-day="6">Sat</button>
              <button type="button" class="day-btn <%= workingDays.includes(0) ? 'active' : '' %>" data-day="0">Sun</button>
            </div>
          </div>
          
          <button type="submit" class="btn-save">
            <i data-feather="save" style="width:18px;height:18px;margin-right:8px;"></i> Save Changes
          </button>
        </div>
        
        <!-- TEAM TAB -->
        <div class="tab-content" id="tab-team">
          <div class="settings-header">
            <h2 class="settings-page-title">Team Members</h2>
            <p class="settings-page-desc">Manage your team and their roles</p>
          </div>
          
          <div class="settings-card">
            <div class="card-title">
              <div class="card-title-icon"><i data-feather="user-plus" style="width:20px;height:20px;"></i></div>
              Add Team Member
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Name</label>
                <input type="text" name="newMemberName" class="form-input" placeholder="Team member name">
              </div>
              <div class="form-group">
                <label class="form-label">Role</label>
                <input type="text" name="newMemberRole" class="form-input" placeholder="e.g. Specialist, Therapist">
              </div>
            </div>
            
            <button type="submit" name="action" value="addMember" class="btn-save" style="margin-top:8px;">
              <i data-feather="plus" style="width:18px;height:18px;margin-right:8px;"></i> Add Member
            </button>
          </div>
          
          <div class="settings-card">
            <div class="card-title">
              <div class="card-title-icon"><i data-feather="users" style="width:20px;height:20px;"></i></div>
              Current Team (<%= owner.teamMembers ? owner.teamMembers.length : 0 %>)
            </div>
            
            <% if (owner.teamMembers && owner.teamMembers.length > 0) { %>
              <div class="team-grid">
                <% owner.teamMembers.forEach(member => { %>
                  <div class="team-card">
                    <div class="team-avatar"><%= member.name ? member.name.charAt(0).toUpperCase() : 'T' %></div>
                    <div class="team-info">
                      <h4><%= member.name %></h4>
                      <p><%= member.role || 'Specialist' %></p>
                    </div>
                    <div class="team-actions">
                      <button type="submit" name="deleteMember" value="<%= member._id %>" class="team-btn danger" title="Remove">
                        <i data-feather="trash-2" style="width:16px;height:16px;"></i>
                      </button>
                    </div>
                  </div>
                <% }) %>
              </div>
            <% } else { %>
              <p style="color:var(--text-muted);text-align:center;padding:40px;">No team members yet. Add your first team member above.</p>
            <% } %>
          </div>
        </div>
        
        <!-- EMAIL TAB -->
        <div class="tab-content" id="tab-email">
          <div class="settings-header">
            <h2 class="settings-page-title">Email Templates</h2>
            <p class="settings-page-desc">Customize your email branding and templates</p>
          </div>
          
          <div class="settings-card">
            <div class="card-title">
              <div class="card-title-icon"><i data-feather="image" style="width:20px;height:20px;"></i></div>
              Branding
            </div>
            
            <div class="form-group">
              <label class="form-label">Business Name (for emails)</label>
              <input type="text" name="emailBusinessName" class="form-input" value="<%= owner.emailSettings && owner.emailSettings.businessName ? owner.emailSettings.businessName : (owner.clinicName || '') %>" placeholder="Your Business Name">
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Primary Color</label>
                <div class="color-row">
                  <input type="color" name="primaryColor" class="color-picker" value="<%= owner.emailSettings && owner.emailSettings.primaryColor ? owner.emailSettings.primaryColor : '#667eea' %>">
                  <input type="text" class="form-input" value="<%= owner.emailSettings && owner.emailSettings.primaryColor ? owner.emailSettings.primaryColor : '#667eea' %>" readonly>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">Secondary Color</label>
                <div class="color-row">
                  <input type="color" name="secondaryColor" class="color-picker" value="<%= owner.emailSettings && owner.emailSettings.secondaryColor ? owner.emailSettings.secondaryColor : '#764ba2' %>">
                  <input type="text" class="form-input" value="<%= owner.emailSettings && owner.emailSettings.secondaryColor ? owner.emailSettings.secondaryColor : '#764ba2' %>" readonly>
                </div>
              </div>
            </div>
          </div>
          
          <button type="submit" class="btn-save">
            <i data-feather="save" style="width:18px;height:18px;margin-right:8px;"></i> Save Changes
          </button>
        </div>
        
        <!-- INTEGRATIONS TAB -->
        <div class="tab-content" id="tab-integrations">
          <div class="settings-header">
            <h2 class="settings-page-title">Integrations</h2>
            <p class="settings-page-desc">Connect external services to your dashboard</p>
          </div>
          
          <div class="settings-card">
            <div class="card-title">
              <div class="card-title-icon"><i data-feather="calendar" style="width:20px;height:20px;"></i></div>
              Google Calendar
            </div>
            
            <p style="color:var(--text-secondary);margin-bottom:20px;">Sync your bookings with Google Calendar to keep everything in one place.</p>
            
            <p style="color:var(--text-muted);font-size:14px;padding:20px;background:var(--bg-primary);border-radius:10px;">
              Google Calendar integration requires OAuth setup. Contact support@buildhaze.com for enterprise integration options.
            </p>
          </div>
        </div>
      </form>
    </main>
  </div>
  
  <script>
    feather.replace();
    
    // Tab switching
    document.querySelectorAll('.nav-item[data-tab]').forEach(btn => {
      btn.addEventListener('click', function() {
        const tab = this.dataset.tab;
        document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        this.classList.add('active');
        document.getElementById('tab-' + tab).classList.add('active');
      });
    });
    
    // Working days toggle
    document.querySelectorAll('.day-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        this.classList.toggle('active');
        updateWorkingDays();
      });
    });
    
    function updateWorkingDays() {
      const days = [];
      document.querySelectorAll('.day-btn.active').forEach(btn => {
        days.push(parseInt(btn.dataset.day));
      });
      document.getElementById('workingDaysData').value = JSON.stringify(days);
    }
    
    // Color picker sync
    document.querySelectorAll('.color-picker').forEach(picker => {
      picker.addEventListener('input', function() {
        this.nextElementSibling.value = this.value;
      });
    });
  </script>
</body>
</html>
